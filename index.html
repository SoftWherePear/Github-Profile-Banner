<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.5/typed.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            /* color: #fff; */
        }
    
        body {
            /* background: #0D1117; #282c34 */
            width: 1100px;
            height: 300px;
            background-color: #000;
        }

        p, span {
            font-size: 16px;
            line-height: 20px;
            /* background-color: aqua; */
        }

        #wrapper {
            overflow: hidden;
            position: relative;
            height: 100%;
            width: 100%;
            filter: blur(1.5px);
        }
    
        #grid {
            position: absolute;
            bottom: 0;
            right: 0;
            background-color: #fff;
            display: grid;
            grid-auto-flow: row;
            place-items: start;
            /* justify-content: stretch; */
            /* align-content: stretch;   */
            /* gap: 0 10px; */
            /* place-content: center; */
            width: 200%;
            height: 200%;
        }

        .cell {
            /* width: 100%; */
            /* border: 2px #ffe603 solid; */
            /* height: 100%; */
            display: flex;
            place-self: stretch;
            /* align-items: center;
            justify-items: start; */
            /* display: block; */
        }

        .typed, .typed-cursor {
            /* position: absolute; */
            /* height: 100%; */
            /* background-color: red; */
            /* margin: auto 0; */
            align-self: center;
        }
    
        .hidden {
            display: none;
        }
    
        .var {
            /*   color: #c678dd; Dark */
            color: #a626a4;
        }
    
        .hex {
            /*   color: #61afef; Dark */
            color: #4078f2;
        }
    
        .num,
        .class {
            /*   color: #d19a66; Dark */
            color: #986801;
        }
    
        .eq {
            /* color: #528BFF; Dark  */
            color: #526EFF;
        }
    
        .prop,
        .tag,
        .element {
            /*   color: #e06c75;  Dark*/
            color: #e45649;
        }
    
        .string {
            /*   color: #98c379; Dark*/
            color: #50a14f;
        }
    
        .inner {
            margin-left: 1rem;
        }
    
        .inner2 {
            margin-left: 2rem;
        }
    
        .inner3 {
            margin-left: 4rem;
        }
    </style>
</head>

<body>
    <p>&lt<span class="tag">h1</span>&gt Hello World! &lt/<span class="tag">h1</span>&gt</p>
    <p>&lt<span class="tag">h1</span>&gt This is a HTML, CSS, and JS animation. &lt/<span class="tag">h1</span>&gt</p>
    <p>&lt<span class="tag">h1</span>&gt Embedded in an SVG for your enjoyment! &lt/<span class="tag">h1</span>&gt</p>
    <p>&lt<span class="tag">h1</span>&gt Thanks for visiting :) &lt/<span class="tag">h1</span>&gt</p>
    <p><span class="var">var</span> foo <span class="eq">=</span> <span class="string">"bar"</span>;</p>
    <p><span class="var">var</span> fooBar <span class="eq">=</span> <span class="string">"baz"</span>;</p>
    
    <script>
        function randRange(min, max) {
            return Math.round(Math.random() * (max - min + 1) + min);
        }

        function getTextWidth(text, font) {
            var canvas = document.createElement("canvas");
            var context = canvas.getContext("2d");
            context.font = font;
            canvas.remove();
            return context.measureText(text).width;
        }

        function getHtmlText(html){
            // Create a new div element
            var temp = document.createElement("div");
            // Set the HTML content with the given value
            temp.innerHTML = html;
            // Retrieve the text property of the element 
            var text = temp.textContent || temp.innerText || "";
            // Destroy temp element
            temp.remove();
            // Return the text
            return text;
        }

        function pseudoRandNum(x, min, max) {
            a = min + (max-min)/2;
            n = ((a * x) % (max + 1)) / (max + 1)
            return Math.round(n * (max - min + 1) + min);
        }

        var textStrings = $("p").map(function () {
            return $(this).html().trim();
        }).get();


        var style = Object.values($("p").css(["font-weight", "font-size", "font-family"])).join(" ").replace(/"/g, "");
        var longestStr = textStrings.reduce(function (a, b) {
                return a.length > b.length ? a : b;
            }
        );

        var maxWidth = getTextWidth(getHtmlText(longestStr), style);

        $("p").addClass("hidden");
        $("p").last().after("<div id='grid'></div>");
        $("#grid").wrap("<div id='wrapper'></div>");

        let numCols = Math.floor($("#grid").css("width").replace(/\D/g, "") / maxWidth);
        let numRows = Math.floor($("#grid").css("height").replace(/\D/g, "") / ($("p").css("line-height").replace(/\D/g, "") * 3));

        let gridDim = ["1fr ".repeat(numRows), "1fr ".repeat(numCols)].join("/ ");
        $("#grid").css("grid", gridDim);


        const cellCount = numCols * numRows;

        var currRow = 0;
        for (i = 1; i <= cellCount; i++) {
            $("#grid").append("<div class='cell row-" + currRow + "'><span id='typed-" + i + "' class='typed'></span></div>");
            if (i % numCols === 0) {
                currRow++;
            }
        }

        var gridAnimation = `
        @keyframes scroll {
            0% {
                transform: translate(0, 0);
            }
            100% {
                transform: translate(0, `+ $("#wrapper").css("height") +`);
            }
        }`;
        
        $("<style>"+ gridAnimation + "</style>").appendTo("head");
        $("#grid").css("animation", "scroll 20s linear infinite alternate");
        
        const wrapWidth = $("#wrapper").css("width").replace(/\D/g, "");
        for (i = 0; i < numRows; i++) {
            const min = Math.floor(wrapWidth/4);
            const max = Math.floor(wrapWidth * 1.5);
            var w = randRange(min, max);

            var cr = $(".row-" + i);
            cr.css("--w", w + "px");

            var rowAnimation = `
            @keyframes slide-r` + i + `{
                0% {
                    transform: translate(0, 0);
                }
                100% {
                    transform: translate(var(--w), 0);
                }
            }`;
            $("<style>"+ rowAnimation + "</style>").appendTo("head");
            cr.css("animation", "slide-r" + i + " 20s linear infinite alternate");
            cr.on('animationiteration',   
            function() {
                $(this).css("--w", pseudoRandNum($(this).css("--w").replace(/\D/g, ""), min, max) + "px");
            });
        }

        var options = {
            strings: textStrings,
            typeSpeed: 70,
            smartBackspace: false,
            backDelay: 2000,
            loop: true,
            onStringTyped: function (pos, self) { 
                self.typeSpeed = randRange(50, 80);
                self.backDelay = randRange(700, 3000);
                self.backSpeed = randRange(0, 30);
                self.startDelay = 0; 
            },
        };

        var typedArr = Array(cellCount);
        for (i = 1; i <= cellCount; i++) {
            typedArr[i] = new Typed("#typed-"+i, options);
            textStrings.sort(() => Math.random() - 0.5);
            options.typeSpeed = randRange(50, 80);
            options.backDelay = randRange(700, 3000);
            options.backSpeed = randRange(0, 30);
            options.startDelay = randRange(500, 5000);
        }
    </script>
</body>